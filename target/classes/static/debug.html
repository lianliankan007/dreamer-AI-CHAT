<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å‘é€æŒ‰é’®è°ƒè¯•é¡µé¢</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; background: #f5f5f5; }
        .debug-panel { background: white; padding: 20px; border-radius: 8px; margin-bottom: 20px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .status { padding: 5px 10px; margin: 5px; border-radius: 4px; }
        .status.true { background: #d4edda; color: #155724; }
        .status.false { background: #f8d7da; color: #721c24; }
        .input-test { width: 100%; padding: 10px; margin: 10px 0; }
        .btn-test { padding: 10px 20px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; }
        .btn-test:disabled { background: #6c757d; cursor: not-allowed; }
        .log { height: 200px; overflow-y: auto; background: #f8f9fa; padding: 10px; border: 1px solid #dee2e6; font-family: monospace; font-size: 12px; }
    </style>
</head>
<body>
    <h1>ğŸ”§ å‘é€æŒ‰é’®è°ƒè¯•é¡µé¢</h1>
    
    <div class="debug-panel">
        <h3>å®æ—¶çŠ¶æ€ç›‘æ§</h3>
        <div id="statusPanel">
            <div class="status" id="hasContentStatus">å†…å®¹æ£€æŸ¥: å¾…æ£€æŸ¥</div>
            <div class="status" id="chatManagerStatus">èŠå¤©ç®¡ç†å™¨: å¾…æ£€æŸ¥</div>
            <div class="status" id="modelsStatus">æ¨¡å‹åŠ è½½: å¾…æ£€æŸ¥</div>
            <div class="status" id="streamingStatus">æµå¼çŠ¶æ€: å¾…æ£€æŸ¥</div>
            <div class="status" id="buttonStatus">æŒ‰é’®çŠ¶æ€: å¾…æ£€æŸ¥</div>
        </div>
    </div>
    
    <div class="debug-panel">
        <h3>æµ‹è¯•è¾“å…¥æ¡†</h3>
        <input type="text" id="testInput" class="input-test" placeholder="åœ¨è¿™é‡Œè¾“å…¥å†…å®¹æµ‹è¯•...">
        <button id="testButton" class="btn-test" disabled>æµ‹è¯•å‘é€æŒ‰é’®</button>
    </div>
    
    <div class="debug-panel">
        <h3>è°ƒè¯•æ—¥å¿—</h3>
        <div id="debugLog" class="log"></div>
        <button onclick="clearLog()">æ¸…ç©ºæ—¥å¿—</button>
        <button onclick="checkMainApp()">æ£€æŸ¥ä¸»åº”ç”¨</button>
    </div>
    
    <div class="debug-panel">
        <h3>å¿«é€Ÿä¿®å¤</h3>
        <button onclick="window.location.href='/'">è¿”å›ä¸»é¡µé¢</button>
        <button onclick="window.location.reload()">åˆ·æ–°é¡µé¢</button>
        <button onclick="forceRefresh()">å¼ºåˆ¶åˆ·æ–°(æ¸…ç¼“å­˜)</button>
    </div>

    <script>
        let logCount = 0;
        
        function log(message) {
            const debugLog = document.getElementById('debugLog');
            const time = new Date().toLocaleTimeString();
            debugLog.innerHTML += `[${time}] ${message}\n`;
            debugLog.scrollTop = debugLog.scrollHeight;
            logCount++;
            if (logCount > 100) {
                clearLog();
            }
        }
        
        function clearLog() {
            document.getElementById('debugLog').innerHTML = '';
            logCount = 0;
        }
        
        function updateStatus(id, value, text) {
            const element = document.getElementById(id);
            element.className = `status ${value}`;
            element.textContent = text;
        }
        
        function checkMainApp() {
            log('æ£€æŸ¥ä¸»åº”ç”¨çŠ¶æ€...');
            
            // æ£€æŸ¥ä¸»é¡µé¢æ˜¯å¦å¯è®¿é—®
            fetch('/')
                .then(response => {
                    log(`ä¸»é¡µé¢çŠ¶æ€: ${response.status}`);
                    return response.text();
                })
                .then(html => {
                    const hasScript = html.includes('app.js');
                    log(`åŒ…å«app.js: ${hasScript}`);
                })
                .catch(error => {
                    log(`ä¸»é¡µé¢è®¿é—®å¤±è´¥: ${error.message}`);
                });
                
            // æ£€æŸ¥é™æ€èµ„æº
            ['js/app.js', 'js/chat.js', 'js/utils.js', 'css/style.css'].forEach(resource => {
                fetch(resource)
                    .then(response => log(`${resource}: ${response.status}`))
                    .catch(error => log(`${resource}: å¤±è´¥ - ${error.message}`));
            });
        }
        
        function testButtonLogic() {
            const input = document.getElementById('testInput');
            const button = document.getElementById('testButton');
            
            const hasContent = input.value.trim().length > 0;
            button.disabled = !hasContent;
            
            updateStatus('hasContentStatus', hasContent, `å†…å®¹æ£€æŸ¥: ${hasContent ? 'æœ‰å†…å®¹' : 'æ— å†…å®¹'} (${input.value.length}å­—ç¬¦)`);
            updateStatus('buttonStatus', !button.disabled, `æŒ‰é’®çŠ¶æ€: ${button.disabled ? 'ç¦ç”¨' : 'å¯ç”¨'}`);
            
            log(`æµ‹è¯•æŒ‰é’®é€»è¾‘: å†…å®¹=${hasContent}, æŒ‰é’®=${button.disabled ? 'ç¦ç”¨' : 'å¯ç”¨'}`);
        }
        
        function forceRefresh() {
            window.location.href = window.location.href + '?t=' + Date.now();
        }
        
        // åˆå§‹åŒ–
        document.getElementById('testInput').addEventListener('input', testButtonLogic);
        document.getElementById('testButton').addEventListener('click', () => {
            log('æµ‹è¯•æŒ‰é’®ç‚¹å‡»æˆåŠŸï¼');
            alert('æµ‹è¯•æŒ‰é’®å·¥ä½œæ­£å¸¸ï¼');
        });
        
        // æ¨¡æ‹Ÿä¸»åº”ç”¨çš„æŒ‰é’®é€»è¾‘
        updateStatus('hasContentStatus', false, 'å†…å®¹æ£€æŸ¥: æ— å†…å®¹');
        updateStatus('chatManagerStatus', false, 'èŠå¤©ç®¡ç†å™¨: æœªè¿æ¥');
        updateStatus('modelsStatus', false, 'æ¨¡å‹åŠ è½½: æœªåŠ è½½');
        updateStatus('streamingStatus', true, 'æµå¼çŠ¶æ€: ç©ºé—²');
        updateStatus('buttonStatus', false, 'æŒ‰é’®çŠ¶æ€: ç¦ç”¨');
        
        log('è°ƒè¯•é¡µé¢åˆå§‹åŒ–å®Œæˆ');
        log('è¯·åœ¨æµ‹è¯•è¾“å…¥æ¡†ä¸­è¾“å…¥å†…å®¹ï¼Œè§‚å¯ŸæŒ‰é’®çŠ¶æ€å˜åŒ–');
        log('å¦‚æœæµ‹è¯•æŒ‰é’®æ­£å¸¸å·¥ä½œï¼Œè¯´æ˜é—®é¢˜åœ¨ä¸»åº”ç”¨çš„JavaScripté€»è¾‘ä¸­');
        
        // å®šæœŸæ£€æŸ¥ä¸»åº”ç”¨çŠ¶æ€
        setInterval(() => {
            if (window.opener && window.opener.app) {
                const app = window.opener.app;
                try {
                    const status = app.getStatus();
                    updateStatus('chatManagerStatus', status.chatManager !== null, 
                        `èŠå¤©ç®¡ç†å™¨: ${status.chatManager ? 'å·²è¿æ¥' : 'æœªè¿æ¥'}`);
                    
                    if (status.chatManager) {
                        updateStatus('modelsStatus', status.chatManager.hasModels, 
                            `æ¨¡å‹åŠ è½½: ${status.chatManager.hasModels ? 'å·²åŠ è½½' : 'æœªåŠ è½½'}`);
                        updateStatus('streamingStatus', !status.chatManager.isStreaming, 
                            `æµå¼çŠ¶æ€: ${status.chatManager.isStreaming ? 'å¤„ç†ä¸­' : 'ç©ºé—²'}`);
                    }
                    
                    log('ä¸»åº”ç”¨çŠ¶æ€æ›´æ–°');
                } catch (error) {
                    log(`ä¸»åº”ç”¨çŠ¶æ€æ£€æŸ¥å¤±è´¥: ${error.message}`);
                }
            }
        }, 2000);
    </script>
</body>
</html> 